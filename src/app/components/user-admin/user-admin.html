<div class="admin-container">
  <!-- Header -->
  <div class="admin-header">
    <h1>üë• Administraci√≥n de Usuarios</h1>
    <p>Gesti√≥n de usuarios del sistema</p>
    <h2>Bienvenido Administrador, {{ authService.currentUserNombreCompleto || 'Cargando' }}</h2>
  </div>

  <!-- Loading -->
  @if (loading) {
  <div class="loading-state">
    <div class="spinner"></div>
    <p>Cargando usuarios...</p>
  </div>
  }

  <!-- Tabla de usuarios -->
  @if (!loading && users.length > 0) {
  <div class="table-container">
    <div class="table-responsive">
      <table class="users-table">
        <thead>
          <tr>
            <th>Nombre Completo</th>
            <th>Email</th>
            <th>Universidad</th>
            <th>Ciudad</th>
            <th>Carrera</th>
            <th>Rol</th>
            <th>Fecha Registro</th>
            <th>Modificado Por</th> <!-- ‚úÖ Nueva columna -->
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          @for (user of users; track user.uid) {
          <tr>
            <td>
              <div class="user-info">
                <div class="user-avatar">
                  {{ getNombreCompleto(user).charAt(0) }}
                </div>
                <div class="user-details">
                  <div class="user-name">{{ getNombreCompleto(user) }}</div>
                </div>
              </div>
            </td>
            <td>{{ user.email }}</td>
            <td>
              <span class="badge university">{{ user.universidad }}</span>
            </td>
            <td>{{ user.ciudad }}</td>
            <td>{{ user.carrera }}</td>
            <td>
              <span class="badge role-{{ user.rol?.toLowerCase() }}">
                {{ user.rol }}
              </span>
            </td>
            <td>{{ formatearFecha(user.createdAt) }}</td>
                <td>
      @if (user.modificadoPor) {
      <div class="modificado-info">
        <div class="modificado-nombre">{{ user.modificadoPor.nombre }}</div>
        <div class="modificado-fecha">{{ formatearFecha(user.modificadoPor.fecha) }}</div>
        <div class="modificado-uuid">UUID: {{ user.modificadoPor.uuid }}</div>
      </div>
      } @else {
      <span class="no-modificado">Nunca modificado</span>
      }
    </td>

            <td>
              <button 
                class="edit-btn"
                (click)="editarUsuario(user)"
                title="Editar usuario"
              >
                ‚úèÔ∏è Editar
              </button>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
  }

  <!-- Sin usuarios -->
  @if (!loading && users.length === 0) {
  <div class="no-data">
    <p>No hay usuarios registrados</p>
  </div>
  }
<br>
<br>
  <button routerLink="/registrar" 
       class="btn btn-secondary"
        style="padding: 10px 20px">
  A√±adir Usuario
</button>

  <!-- Modal de edici√≥n -->
@if (editingUser) {
<div class="modal-overlay">
  <div class="modal-content">
    <div class="modal-header">
      <h2>‚úèÔ∏è Editar Usuario</h2>
      <button class="close-btn" (click)="cancelarEdicion()">√ó</button>
    </div>

    <div class="modal-body">
      <form (ngSubmit)="guardarCambios()" #userForm="ngForm">
        
        <!-- Informaci√≥n B√°sica -->
        <div class="form-section">
          <h3 class="section-title">
            <span class="section-icon">üë§</span>
            Informaci√≥n Personal
          </h3>
          <div class="form-grid">
            
            <div class="form-group">
              <label for="primerNombre">Primer Nombre *</label>
              <input 
                type="text" 
                id="primerNombre"
                [(ngModel)]="editedUser.primerNombre" 
                name="primerNombre"
                required
                placeholder="Ingrese el primer nombre"
              >
            </div>

            <div class="form-group">
              <label for="segundoNombre">Segundo Nombre</label>
              <input 
                type="text" 
                id="segundoNombre"
                [(ngModel)]="editedUser.segundoNombre" 
                name="segundoNombre"
                placeholder="Opcional"
              >
            </div>

            <div class="form-group">
              <label for="primerApellido">Primer Apellido *</label>
              <input 
                type="text" 
                id="primerApellido"
                [(ngModel)]="editedUser.primerApellido" 
                name="primerApellido"
                required
                placeholder="Ingrese el primer apellido"
              >
            </div>

            <div class="form-group">
              <label for="segundoApellido">Segundo Apellido</label>
              <input 
                type="text" 
                id="segundoApellido"
                [(ngModel)]="editedUser.segundoApellido" 
                name="segundoApellido"
                placeholder="Opcional"
              >
            </div>

          </div>
        </div>

        <!-- Informaci√≥n Acad√©mica -->
        <div class="form-section">
          <h3 class="section-title">
            <span class="section-icon">üéì</span>
            Informaci√≥n Acad√©mica
          </h3>
          <div class="form-grid">
            
            <div class="form-group">
              <label for="universidad">Universidad *</label>
              <select 
                id="universidad"
                [(ngModel)]="editedUser.universidad" 
                name="universidad"
                required
              >
                <option value="">Seleccionar universidad</option>
                @for (uni of universidades; track uni) {
                <option [value]="uni">{{ uni }}</option>
                }
              </select>
            </div>

            <div class="form-group">
              <label for="ciudad">Ciudad *</label>
              <select 
                id="ciudad"
                [(ngModel)]="editedUser.ciudad" 
                name="ciudad"
                required
              >
                <option value="">Seleccionar ciudad</option>
                @for (ciudad of ciudades; track ciudad) {
                <option [value]="ciudad">{{ ciudad }}</option>
                }
              </select>
            </div>

            <div class="form-group">
              <label for="carrera">Carrera *</label>
              <input 
                type="text" 
                id="carrera"
                [(ngModel)]="editedUser.carrera" 
                name="carrera"
                required
                placeholder="Ingrese la carrera"
              >
            </div>

            <div class="form-group">
              <label for="rol">Rol *</label>
              <select 
                id="rol"
                [(ngModel)]="editedUser.rol" 
                name="rol"
                required
              >
                <option value="">Seleccionar rol</option>
                @for (rol of roles; track rol) {
                <option [value]="rol">{{ rol }}</option>
                }
              </select>
            </div>

          </div>
        </div>

        <!-- Informaci√≥n de Contacto -->
        <div class="form-section">
          <h3 class="section-title">
            <span class="section-icon">üìß</span>
            Informaci√≥n de Contacto
          </h3>
          <div class="form-grid">
            
            <div class="form-group full-width">
              <label for="email">Correo Electr√≥nico</label>
              <input 
                type="email" 
                id="email"
                [value]="editedUser.email" 
                disabled
                class="disabled-field"
                placeholder="Email del usuario"
              >
              <small class="field-note">El email no se puede modificar</small>
            </div>

          </div>
        </div>

        <!-- Acciones -->
        <div class="modal-actions">
          <button 
            type="button" 
            class="cancel-btn"
            (click)="cancelarEdicion()"
          >
            Cancelar
          </button>
          <button 
            type="submit" 
            class="save-btn"
            [disabled]="!userForm.valid"
          >
            üíæ Guardar Cambios
          </button>
        </div>

      </form>
    </div>
  </div>
</div>
}
</div>
